{"ast":null,"code":"var _jsxFileName = \"/Users/sebastian/Desktop/mapa-social-sin-claves/mapa-social/src/componentes/Mapa.js\";\nimport React, { Component } from \"react\";\nimport GoogleMapReact from 'google-map-react';\nimport Popup from 'reactjs-popup';\nimport { getToken, apiPath } from './funciones';\nconst divStyle = {\n  color: 'white',\n  background: 'black',\n  padding: '5px',\n  textAlign: 'center',\n  alignItems: 'center',\n  justifyContent: 'center',\n  borderRadius: '100%',\n  position: 'absolute'\n};\n\nclass Marcador extends Component {\n  renderMarcador() {\n    if (this.props.perfil !== null && typeof this.props.perfil.imagen !== \"undefined\") {\n      return React.createElement(Popup, {\n        trigger: React.createElement(\"button\", {\n          style: {\n            'background-image': 'url(' + this.props.perfil.imagen + ')',\n            width: '15%',\n            margin: '1%',\n            color: 'white',\n            padding: '15px',\n            alignItems: 'center',\n            justifyContent: 'center',\n            borderRadius: '100%',\n            position: 'absolute',\n            'background-size': 'cover'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 20\n          },\n          __self: this\n        }, \"  \"),\n        position: \"bottom center\",\n        closeOnDocumentClick: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 19\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        class: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 32\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 33\n        },\n        __self: this\n      }, \"Latitud\"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 33\n        },\n        __self: this\n      }, this.props.lat, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34\n        },\n        __self: this\n      }, \"Longitud\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34\n        },\n        __self: this\n      }, this.props.lng, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35\n        },\n        __self: this\n      }, \"Fecha y Hora\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35\n        },\n        __self: this\n      }, this.props.fyh, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36\n        },\n        __self: this\n      }, \"email\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36\n        },\n        __self: this\n      }, this.props.email, \" \")));\n    } else {\n      return React.createElement(Popup, {\n        trigger: React.createElement(\"button\", {\n          style: divStyle,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 42\n          },\n          __self: this\n        }, \"X\"),\n        position: \"bottom center\",\n        closeOnDocumentClick: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        class: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 46\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47\n        },\n        __self: this\n      }, \"Latitud\"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47\n        },\n        __self: this\n      }, this.props.lat, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }, \"Longitud\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }, this.props.lng, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 49\n        },\n        __self: this\n      }, \"Fecha y Hora\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 49\n        },\n        __self: this\n      }, this.props.fyh, \" \"), React.createElement(\"div\", {\n        className: \"col-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50\n        },\n        __self: this\n      }, \"email\"), React.createElement(\"div\", {\n        className: \"col-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50\n        },\n        __self: this\n      }, this.props.email, \" \")));\n    }\n  }\n\n  render() {\n    return this.renderMarcador();\n  }\n\n}\n\nclass Mapa extends Component {\n  constructor() {\n    super();\n    this.state = {\n      lat: 0,\n      lon: 0,\n      loc: [],\n      busqueda: '',\n      fechaDesde: '',\n      fechaHasta: '',\n      json: [],\n      email: '',\n      usuarios: [],\n      perfiles: []\n    }; //this.send = this.send.bind(this);\n  }\n\n  componentDidMount() {\n    this.getContactos();\n    this.setState({\n      email: JSON.parse(localStorage.getItem('acc')).email\n    });\n    this.getLoc();\n    /*\n    socket\n      .emit('usuarios on')\n      .on('usuarios on', (usuarios) => {\n        this.setState({ usuarios: usuarios });\n      })\n      .on('usuarios p', (perfiles) => {\n        this.setState({ perfiles: perfiles });\n      })\n      .on('error', function () {\n        salir();\n      });\n      */\n\n    this.interval = setInterval(() => {\n      this.getLoc(); //this.send();\n    }, 15000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  getLoc() {\n    navigator.geolocation.getCurrentPosition(position => {\n      this.setState({\n        lat: position.coords.latitude,\n        lon: position.coords.longitude\n      });\n      this.enviarJsonPos();\n    });\n  }\n\n  enviarJsonPos() {\n    alert(this.state.busqueda);\n    let ubicacion = {\n      lat: this.state.lat,\n      lng: this.state.lon\n    };\n    let url = apiPath() + '/gms';\n    let jsonPos = {\n      ubicacion: ubicacion,\n      bus: this.state.busqueda\n    };\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': getToken()\n      },\n      body: JSON.stringify(jsonPos)\n    }).then(res => res.json()) //.then (data => alert(JSON.stringify(data)))\n    .then(data => this.setState({\n      json: data\n    }));\n  }\n\n  send() {\n    let loc = {\n      lat: this.state.lat,\n      lon: this.state.lon,\n      par: this.state.busqueda,\n      email: this.state.email\n    };\n    var par = this.state.busqueda;\n\n    if (par !== '') {\n      /*\n      socket\n      .emit('obtener loc', loc)\n      .on(par, (col) => {\n        this.setState({ json: col });\n      });\n      */\n    }\n  }\n\n  getContactos() {\n    let url = apiPath() + '/contactos';\n    fetch(url, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': getToken()\n      }\n    }).then(response => response.json()).then(data => this.procesarContactos(data)); //.then(() => this.send());\n  }\n\n  procesarContactos(data) {\n    let aux = [];\n\n    if (data && data.length > 0) {\n      for (let i in data) {\n        aux.push(data[i].email);\n      }\n\n      let bus = aux.toString();\n      bus = bus + ',' + this.state.email;\n      this.setState({\n        busqueda: bus\n      });\n    }\n  }\n\n  crearMarcadores() {\n    let json = this.state.json;\n    var cont = 0;\n    var aux = [];\n\n    if (json && json[0]) {\n      for (let i in json) {\n        aux[cont] = React.createElement(Marcador, {\n          lat: json[i][\"geoloc\"][\"lat\"],\n          lng: json[i][\"geoloc\"][\"lon\"],\n          fyh: json[i][\"fyh\"],\n          email: json[i]['email'],\n          perfil: json[i]['perfil'],\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        });\n        cont++;\n      }\n    }\n\n    return aux;\n  }\n\n  recorrerJson() {\n    let j = this.crearMarcadores().map(js => {\n      return js;\n    });\n    return j;\n  }\n\n  mostratMapa() {\n    let center = {\n      lat: Number(this.state.lat),\n      lng: Number(this.state.lon)\n    };\n\n    if (this.state.lat === 0 && this.state.lon === 0) {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, \"Cargando\");\n    } else {\n      return React.createElement(GoogleMapReact //'AIzaSyD1v9xM2VDXcVBbQhPIgo7Sns4Q5EmlHvs' pago\n      //'AIzaSyDn7YihSIf91daFsXfA17mDvNaiM_ZFB_4' gratis\n      , {\n        bootstrapURLKeys: {\n          key: 'AIzaSyD1v9xM2VDXcVBbQhPIgo7Sns4Q5EmlHvs'\n        },\n        defaultCenter: center,\n        defaultZoom: 11,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, this.recorrerJson());\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      style: {\n        height: '90vh',\n        width: '90vw'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, this.mostratMapa(), JSON.stringify(this.state.usuarios));\n  }\n\n}\n\nexport default Mapa;","map":{"version":3,"sources":["/Users/sebastian/Desktop/mapa-social-sin-claves/mapa-social/src/componentes/Mapa.js"],"names":["React","Component","GoogleMapReact","Popup","getToken","apiPath","divStyle","color","background","padding","textAlign","alignItems","justifyContent","borderRadius","position","Marcador","renderMarcador","props","perfil","imagen","width","margin","lat","lng","fyh","email","render","Mapa","constructor","state","lon","loc","busqueda","fechaDesde","fechaHasta","json","usuarios","perfiles","componentDidMount","getContactos","setState","JSON","parse","localStorage","getItem","getLoc","interval","setInterval","componentWillUnmount","clearInterval","navigator","geolocation","getCurrentPosition","coords","latitude","longitude","enviarJsonPos","alert","ubicacion","url","jsonPos","bus","fetch","method","headers","body","stringify","then","res","data","send","par","response","procesarContactos","aux","length","i","push","toString","crearMarcadores","cont","recorrerJson","j","map","js","mostratMapa","center","Number","key","height"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport GoogleMapReact from 'google-map-react';\nimport Popup from 'reactjs-popup';\nimport { getToken, apiPath } from './funciones';\nconst divStyle = {\n  color: 'white',\n  background: 'black',\n  padding: '5px',\n  textAlign: 'center',\n  alignItems: 'center',\n  justifyContent: 'center',\n  borderRadius: '100%',\n  position: 'absolute',\n\n};\nclass Marcador extends Component {\n  renderMarcador() {\n    if (this.props.perfil !== null && typeof this.props.perfil.imagen !== \"undefined\") {\n      return <Popup\n        trigger={<button style={{\n          'background-image': 'url(' + this.props.perfil.imagen + ')', width: '15%', margin: '1%', color: 'white',\n          padding: '15px',\n          alignItems: 'center',\n          justifyContent: 'center',\n          borderRadius: '100%',\n          position: 'absolute',\n          'background-size': 'cover',\n        }} >  </button>}\n        position=\"bottom center\"\n        closeOnDocumentClick\n      >\n        <div class=\"row\">\n          <div className=\"col-6\" >Latitud</div><div className=\"col-4\" >{this.props.lat} </div>\n          <div className=\"col-4\">Longitud</div><div className=\"col-6\">{this.props.lng} </div>\n          <div className=\"col-4\">Fecha y Hora</div><div className=\"col-6\">{this.props.fyh} </div>\n          <div className=\"col-4\">email</div><div className=\"col-6\">{this.props.email} </div>\n        </div>\n      </Popup>\n    }\n    else {\n      return <Popup\n        trigger={<button style={divStyle} >X</button>}\n        position=\"bottom center\"\n        closeOnDocumentClick\n      >\n        <div class=\"row\">\n          <div className=\"col-6\" >Latitud</div><div className=\"col-4\" >{this.props.lat} </div>\n          <div className=\"col-4\">Longitud</div><div className=\"col-6\">{this.props.lng} </div>\n          <div className=\"col-4\">Fecha y Hora</div><div className=\"col-6\">{this.props.fyh} </div>\n          <div className=\"col-4\">email</div><div className=\"col-6\">{this.props.email} </div>\n        </div>\n      </Popup>\n    }\n  }\n  render() {\n    return (\n      this.renderMarcador()\n    );\n  }\n}\n\nclass Mapa extends Component {\n  constructor() {\n    super();\n    this.state = {\n      lat: 0,\n      lon: 0,\n      loc: [],\n      busqueda: '',\n      fechaDesde: '',\n      fechaHasta: '',\n      json: [],\n      email: '',\n      usuarios: [],\n      perfiles: [],\n    };\n    //this.send = this.send.bind(this);\n  }\n  componentDidMount() {\n    this.getContactos();\n    this.setState({ email: JSON.parse(localStorage.getItem('acc')).email });\n    this.getLoc();\n    /*\n    socket\n      .emit('usuarios on')\n      .on('usuarios on', (usuarios) => {\n        this.setState({ usuarios: usuarios });\n      })\n      .on('usuarios p', (perfiles) => {\n        this.setState({ perfiles: perfiles });\n      })\n      .on('error', function () {\n        salir();\n      });\n      */\n    this.interval = setInterval(() => {\n      this.getLoc();\n      //this.send();\n    }, 15000);\n  }\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  getLoc() {\n    navigator.geolocation.getCurrentPosition((position) => {\n      this.setState({ lat: position.coords.latitude, lon: position.coords.longitude });\n      this.enviarJsonPos();\n    })\n  }\n  enviarJsonPos() {\n    alert(this.state.busqueda)\n    let ubicacion = {lat: this.state.lat, lng: this.state.lon};\n    let url = apiPath()+'/gms';\n    let jsonPos = { ubicacion: ubicacion, bus: this.state.busqueda};\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': getToken()\n      },\n      body: JSON.stringify(jsonPos),\n    })\n      .then(res => res.json())\n      //.then (data => alert(JSON.stringify(data)))\n      .then(data => this.setState({ json: data }))\n  }\n  send() {\n    let loc = { lat: this.state.lat, lon: this.state.lon, par: this.state.busqueda, email: this.state.email };\n    var par = this.state.busqueda;\n    if (par !== '') {\n        /*\n      socket\n        .emit('obtener loc', loc)\n        .on(par, (col) => {\n          this.setState({ json: col });\n        });\n        */\n    }\n  }\n\n  getContactos() {\n    let url = apiPath() + '/contactos';\n    fetch(url, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': getToken()\n      },\n    })\n      .then(response => response.json())\n      .then(data => this.procesarContactos(data))\n      //.then(() => this.send());\n\n  }\n  procesarContactos(data) {\n    let aux = [];\n    if (data && data.length > 0) {\n      for (let i in data) {\n        aux.push(data[i].email);\n      }\n      let bus = aux.toString();\n      bus = bus + ',' + this.state.email\n      this.setState({ busqueda: bus });\n    }\n  }\n  crearMarcadores() {\n    let json = this.state.json;\n    var cont = 0;\n    var aux = [];\n    if(json && json[0]){\n      for (let i in json) {\n      aux[cont] = <Marcador\n        lat={json[i][\"geoloc\"][\"lat\"]}\n        lng={json[i][\"geoloc\"][\"lon\"]}\n        fyh={json[i][\"fyh\"]}\n        email={json[i]['email']}\n        perfil={json[i]['perfil']}\n      />;\n      cont++;\n    }\n    }\n    \n    return aux;\n  }\n  recorrerJson() {\n    let j = this.crearMarcadores().map(js => {\n      return js\n    })\n    return j;\n  }\n  mostratMapa() {\n    let center = {\n      lat: Number(this.state.lat),\n      lng: Number(this.state.lon)\n    };\n    if (this.state.lat === 0 && this.state.lon === 0) {\n      return <div>Cargando</div>\n    }\n    else {\n      return <GoogleMapReact\n        //'AIzaSyD1v9xM2VDXcVBbQhPIgo7Sns4Q5EmlHvs' pago\n        //'AIzaSyDn7YihSIf91daFsXfA17mDvNaiM_ZFB_4' gratis\n        bootstrapURLKeys={{ key: 'AIzaSyD1v9xM2VDXcVBbQhPIgo7Sns4Q5EmlHvs' }}\n        defaultCenter={center}\n        defaultZoom={11}\n      >\n        {this.recorrerJson()}\n      </GoogleMapReact>;\n    }\n  }\n\n  render() {\n    return (\n      <div style={{ height: '90vh', width: '90vw' }}>\n        {this.mostratMapa()}\n        {JSON.stringify(this.state.usuarios)}\n      </div>\n    )\n  }\n}\nexport default Mapa;"]},"metadata":{},"sourceType":"module"}